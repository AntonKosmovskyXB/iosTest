!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("exifr"),require("pica"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@digitalascetic/ngx-pica",["exports","@angular/core","rxjs","exifr","pica","rxjs/operators"],t):t(((e=e||self).digitalascetic=e.digitalascetic||{},e.digitalascetic["ngx-pica"]={}),e.ng.core,e.rxjs,e.exifr,e.Pica,e.rxjs.operators)}(this,(function(e,t,r,n,i,o){"use strict";i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var a;function c(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function s(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e){e.NO_FILES_RECEIVED="NO_FILES_RECEIVED",e.CANVAS_CONTEXT_IDENTIFIER_NOT_SUPPORTED="CANVAS_CONTEXT_IDENTIFIER_NOT_SUPPORTED",e.NOT_BE_ABLE_TO_COMPRESS_ENOUGH="NOT_BE_ABLE_TO_COMPRESS_ENOUGH",e.READ_ERROR="IMAGE_COULD_NOT_BE_LOADED"}(a||(a={}));var f=function(){function e(){}return e.prototype.getExifOrientedImage=function(e){return new Promise((function(t,r){n.orientation(e).catch((function(r){t(e)})).then((function(r){if(r&&1!==r){if(r<1||r>8)throw new Error("orientation should be [1-8]");var n=document.createElement("canvas"),i=n.getContext("2d"),o=0,a=0,c=0,s=e.width,f=e.height;switch([5,6,7,8].indexOf(r)>-1&&(s=e.height,f=e.width),n.width=s,n.height=f,r){case 3:case 4:a=-e.width,c=-e.height,o=180;break;case 5:case 6:c=-e.height,o=90;break;case 7:case 8:a=-e.width,o=270}[2,4,5,7].indexOf(r)>-1&&(i.translate(s,0),i.scale(-1,1)),i.rotate(o/180*Math.PI),i.drawImage(e,a,c);var p=new Image;p.width=s,p.height=f,p.onload=function(){t(p)},p.src=n.toDataURL()}else t(e)}))}))},e=c([t.Injectable()],e)}(),p=function(){function e(e){this._ngxPicaExifService=e,this.picaResizer=new i,this.MAX_STEPS=20,this.picaResizer&&this.picaResizer.resize||(this.picaResizer=new window.Pica)}return e.prototype.resizeImages=function(e,t,n,i){var c=this,s=new r.Subject,f=e.length;if(f>0){var p=new r.Subject,u=0,d=p.pipe(o.switchMap((function(e){return c.resizeImage(e,t,n,i)}))).subscribe((function(t){u++,s.next(t),u<f?p.next(e[u]):(s.complete(),d.unsubscribe())}),(function(t){var r={file:e[u],err:t};s.error(r)}));p.next(e[u])}else{var g={err:a.NO_FILES_RECEIVED};s.error(g),s.complete()}return s.asObservable()},e.prototype.resizeImage=function(e,t,n,i){var o=this,c=new r.Subject,s=document.createElement("canvas"),f=s.getContext("2d"),p=new Image,u=new FileReader;return i||(i={exifOptions:{forceExifOrientation:!0}}),f?(u.addEventListener("load",(function(r){p.onerror=function(t){c.error({err:a.READ_ERROR,file:e,original_error:t})},p.onload=function(){o.processImageExifOptions(p,i.exifOptions).then((function(r){s.width=r.width,s.height=r.height,f.drawImage(r,0,0);var a=f.getImageData(0,0,r.width,r.height);if(i&&i.aspectRatio&&i.aspectRatio.keepAspectRatio){var p=0;p=i.aspectRatio.forceMinDimensions?Math.max(t/a.width,n/a.height):Math.min(t/a.width,n/a.height),t=Math.round(a.width*p),n=Math.round(a.height*p)}var u=document.createElement("canvas");u.width=t,u.height=n,o.picaResize(e,s,u,i).catch((function(e){return c.error(e)})).then((function(e){c.next(e),c.complete()}))})).catch((function(t){c.error({err:a.READ_ERROR,file:e,original_error:t})}))},p.src=u.result})),u.readAsDataURL(e)):c.error(a.CANVAS_CONTEXT_IDENTIFIER_NOT_SUPPORTED),c.asObservable()},e.prototype.compressImages=function(e,t,n){var i=this,c=new r.Subject,s=e.length;if(s>0){var f=new r.Subject,p=0,u=f.pipe(o.switchMap((function(e){return i.compressImage(e,t,n)}))).subscribe((function(t){p++,c.next(t),p<s?f.next(e[p]):(c.complete(),u.unsubscribe())}),(function(t){var r={file:e[p],err:t};c.error(r)}));f.next(e[p])}else{var d={err:a.NO_FILES_RECEIVED};c.error(d),c.complete()}return c.asObservable()},e.prototype.compressImage=function(e,t,n){var i=this,o=new r.Subject;if(this.bytesToMB(e.size)<=t)setTimeout((function(){o.next(e),o.complete()}));else{var c=document.createElement("canvas"),s=c.getContext("2d"),f=new Image,p=new FileReader;n||(n={exifOptions:{forceExifOrientation:!0}}),s?(p.addEventListener("load",(function(r){f.onload=function(){i.processImageExifOptions(f,n.exifOptions).then((function(r){c.width=r.width,c.height=r.height,s.drawImage(r,0,0),i.getCompressedImage(c,e.type,1,t,0).catch((function(e){return o.error(e)})).then((function(t){var r=i.blobToFile(t,e.name,e.type,(new Date).getTime());o.next(r),o.complete()}))}))},f.src=p.result})),p.readAsDataURL(e)):o.error(a.CANVAS_CONTEXT_IDENTIFIER_NOT_SUPPORTED)}return o.asObservable()},e.prototype.processImageExifOptions=function(e,t){var r=this;return new Promise((function(n,i){t.forceExifOrientation?r._ngxPicaExifService.getExifOrientedImage(e).then((function(e){return n(e)})).catch((function(e){return i(e)})):n(e)}))},e.prototype.getCompressedImage=function(e,t,r,n,i){var o=this;return new Promise((function(a,c){o.picaResizer.toBlob(e,t,r).catch((function(e){return c(e)})).then((function(t){o.checkCompressedImageSize(e,t,r,n,i).catch((function(e){return c(e)})).then((function(e){a(e)}))}))}))},e.prototype.checkCompressedImageSize=function(e,t,r,n,i){var o=this;return new Promise((function(c,s){if(i>o.MAX_STEPS)s(a.NOT_BE_ABLE_TO_COMPRESS_ENOUGH);else if(o.bytesToMB(t.size)<n)c(t);else{var f=r-.1*r,p=i+1;c(o.getCompressedImage(e,t.type,f,n,p))}}))},e.prototype.picaResize=function(e,t,r,n){var i=this;return new Promise((function(o,a){i.picaResizer.resize(t,r,n).catch((function(e){return a(e)})).then((function(t){return i.picaResizer.toBlob(t,e.type)})).then((function(t){var r=i.blobToFile(t,e.name,e.type,(new Date).getTime());o(r)}))}))},e.prototype.blobToFile=function(e,t,r,n){return Object.assign(new Blob([e],{type:r}),{name:t,lastModified:n})},e.prototype.bytesToMB=function(e){return e/1048576},e.ctorParameters=function(){return[{type:f}]},e=c([t.Injectable(),s("design:paramtypes",[f])],e)}(),u=function(){function e(){this.imageExtensions=["ase","art","bmp","blp","cd5","cit","cpt","cr2","cut","dds","dib","djvu","egt","exif","gif","gpl","grf","icns","ico","iff","jng","jpeg","jpg","jfif","jp2","jps","lbm","max","miff","mng","msp","nitf","ota","pbm","pc1","pc2","pc3","pcf","pcx","pdn","pgm","PI1","PI2","PI3","pict","pct","pnm","pns","ppm","psb","psd","pdd","psp","px","pxm","pxr","qfx","raw","rle","sct","sgi","rgb","int","bw","tga","tiff","tif","vtf","xbm","xcf","xpm","3dv","amf","ai","awg","cgm","cdr","cmx","dxf","e2d","egt","eps","fs","gbr","odg","svg","stl","vrml","x3d","sxd","v2d","vnd","wmf","emf","art","xar","png","webp","jxr","hdp","wdp","cur","ecw","iff","lbm","liff","nrrd","pam","pcx","pgf","sgi","rgb","rgba","bw","int","inta","sid","ras","sun","tga"]}return e.prototype.isImage=function(e){var t=e.name.toLowerCase().substr(e.name.lastIndexOf(".")+1);return-1!==this.imageExtensions.indexOf(t)},e=c([t.Injectable()],e)}(),d=function(){function e(){}return e=c([t.NgModule({providers:[{provide:p,useClass:p},{provide:f,useClass:f},{provide:u,useClass:u}]})],e)}();e.NgxPicaImageService=u,e.NgxPicaModule=d,e.NgxPicaService=p,e.Éµa=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=digitalascetic-ngx-pica.umd.min.js.map