import { Color } from './color.class';
import { Subject, BehaviorSubject } from 'rxjs';
import { distinctUntilChanged } from 'rxjs/operators';
import { Rgba } from './rgba.class';
export var ColorType;
(function (ColorType) {
    ColorType["hex"] = "hex";
    ColorType["hexa"] = "hexa";
    ColorType["rgba"] = "rgba";
    ColorType["rgb"] = "rgb";
    ColorType["hsla"] = "hsla";
    ColorType["hsl"] = "hsl";
    ColorType["cmyk"] = "cmyk";
})(ColorType || (ColorType = {}));
export class ColorPickerControl {
    constructor() {
        this.modelValue = null;
        this.hueValue = null;
        this.initValue = null;
        this.valueChanged = new Subject();
        this.presetsVisibilityChanges = new BehaviorSubject(true);
        this.initType = null;
        this.alphaChannelVisibilityChanges = new BehaviorSubject(true);
        this.valueChanges = this.valueChanged.asObservable().pipe(distinctUntilChanged((x, y) => x.toRgbaString() == y.toRgbaString()));
        this.colorPresets = [];
        const color = Color.from(new Rgba(255, 0, 0, 1));
        this.setValue(color);
        this.setHueColor(color);
    }
    setValueFrom(color) {
        const newColor = Color.from(color);
        if (!this.initValue) {
            this.initValue = Color.from(color);
        }
        if (typeof color === 'string') {
            this.finOutInputType(color);
        }
        this.setHueColor(newColor);
        this.setValue(newColor);
        return this;
    }
    setHueColor(color) {
        if (this.hueValue && color.getHsva().hue > 0 || !this.hueValue) {
            this.hueValue = new Color().setHsva(color.getHsva().hue);
        }
    }
    get hue() {
        return this.hueValue;
    }
    /**
     * @internal
     * used for two-way data binding
     */
    set hue(hueColor) {
        this.hueValue = hueColor;
    }
    setValue(value) {
        this.modelValue = value;
        this.valueChanged.next(value);
        return this;
    }
    get value() {
        return this.modelValue;
    }
    /**
     * @internal
     * used for two-way data binding
     */
    set value(value) {
        this.setValue(value);
    }
    /**
     * reset color to initial
     */
    reset() {
        let color;
        if (!this.initValue) {
            color = Color.from(new Rgba(255, 0, 0, 1));
            this.hueValue = new Color().setHsva(color.getHsva().hue);
        }
        else {
            color = this.initValue.clone();
            this.setHueColor(color);
        }
        this.setValue(color);
        return this;
    }
    isAlphaChannelEnabled() {
        return this.alphaChannelVisibilityChanges.value;
    }
    showAlphaChannel() {
        this.alphaChannelVisibilityChanges.next(true);
        return this;
    }
    hideAlphaChannel() {
        this.alphaChannelVisibilityChanges.next(false);
        return this;
    }
    finOutInputType(colorString) {
        const str = colorString.replace(/ /g, '').toLowerCase();
        if (str[0] === '#') {
            this.initType = ColorType.hex;
            if (str.length > 7) {
                this.initType = ColorType.hexa;
            }
        }
        const OpenParenthesis = str.indexOf('(');
        const colorTypeName = str.substr(0, OpenParenthesis);
        switch (colorTypeName) {
            case ColorType.rgba:
                this.initType = ColorType.rgba;
                break;
            case ColorType.rgb:
                this.initType = ColorType.rgb;
                break;
            case ColorType.hsla:
                this.initType = ColorType.hsla;
                break;
            case ColorType.hsl:
                this.initType = ColorType.hsl;
                break;
            case ColorType.cmyk:
                this.initType = ColorType.cmyk;
                break;
        }
    }
    setColorPresets(colorPresets) {
        this.colorPresets = this.setPresets(colorPresets);
        return this;
    }
    setPresets(colorPresets) {
        const presets = [];
        for (const color of colorPresets) {
            if (Array.isArray(color)) {
                presets.push(this.setPresets(color));
            }
            else {
                presets.push(new Color(color));
            }
        }
        return presets;
    }
    get presets() {
        return this.colorPresets;
    }
    hasPresets() {
        return this.colorPresets.length > 0;
    }
    isPresetVisible() {
        return this.presetsVisibilityChanges.value;
    }
    showPresets() {
        this.presetsVisibilityChanges.next(true);
        return this;
    }
    hidePresets() {
        this.presetsVisibilityChanges.next(false);
        return this;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbC5jbGFzcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lwbGFiL25neC1jb2xvci1waWNrZXIvc3JjL2xpYi9oZWxwZXJzL2NvbnRyb2wuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBZSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBSXBDLE1BQU0sQ0FBTixJQUFZLFNBUVg7QUFSRCxXQUFZLFNBQVM7SUFDakIsd0JBQVcsQ0FBQTtJQUNYLDBCQUFhLENBQUE7SUFDYiwwQkFBYSxDQUFBO0lBQ2Isd0JBQVcsQ0FBQTtJQUNYLDBCQUFhLENBQUE7SUFDYix3QkFBVyxDQUFBO0lBQ1gsMEJBQWEsQ0FBQTtBQUNqQixDQUFDLEVBUlcsU0FBUyxLQUFULFNBQVMsUUFRcEI7QUFFRCxNQUFNLE9BQU8sa0JBQWtCO0lBYzNCO1FBWlEsZUFBVSxHQUFVLElBQUksQ0FBQztRQUN6QixhQUFRLEdBQVUsSUFBSSxDQUFDO1FBQ3ZCLGNBQVMsR0FBVSxJQUFJLENBQUM7UUFDZixpQkFBWSxHQUFtQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBRTlDLDZCQUF3QixHQUE2QixJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RixhQUFRLEdBQWMsSUFBSSxDQUFDO1FBQ2xCLGtDQUE2QixHQUE2QixJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwRixpQkFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMs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QyxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRU0sV0FBVztRQUNkLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUMsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29sb3IsIENvbG9yU3RyaW5nIH0gZnJvbSAnLi9jb2xvci5jbGFzcyc7XHJcbmltcG9ydCB7IFN1YmplY3QsIEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgUmdiYSB9IGZyb20gJy4vcmdiYS5jbGFzcyc7XHJcbmltcG9ydCB7IEhzbGEgfSBmcm9tICcuL2hzbGEuY2xhc3MnO1xyXG5pbXBvcnQgeyBIc3ZhIH0gZnJvbSAnLi9oc3ZhLmNsYXNzJztcclxuXHJcbmV4cG9ydCBlbnVtIENvbG9yVHlwZSB7XHJcbiAgICBoZXggPSAnaGV4JyxcclxuICAgIGhleGEgPSAnaGV4YScsXHJcbiAgICByZ2JhID0gJ3JnYmEnLFxyXG4gICAgcmdiID0gJ3JnYicsXHJcbiAgICBoc2xhID0gJ2hzbGEnLFxyXG4gICAgaHNsID0gJ2hzbCcsXHJcbiAgICBjbXlrID0gJ2NteWsnXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDb2xvclBpY2tlckNvbnRyb2wge1xyXG5cclxuICAgIHByaXZhdGUgbW9kZWxWYWx1ZTogQ29sb3IgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBodWVWYWx1ZTogQ29sb3IgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBpbml0VmFsdWU6IENvbG9yID0gbnVsbDtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgdmFsdWVDaGFuZ2VkOiBTdWJqZWN0PENvbG9yPiA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgcHVibGljIHJlYWRvbmx5IHByZXNldHNWaXNpYmlsaXR5Q2hhbmdlczogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdCh0cnVlKTtcclxuICAgIHB1YmxpYyBpbml0VHlwZTogQ29sb3JUeXBlID0gbnVsbDtcclxuICAgIHB1YmxpYyByZWFkb25seSBhbHBoYUNoYW5uZWxWaXNpYmlsaXR5Q2hhbmdlczogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdCh0cnVlKTtcclxuICAgIHB1YmxpYyByZWFkb25seSB2YWx1ZUNoYW5nZXMgPSB0aGlzLnZhbHVlQ2hhbmdlZC5hc09ic2VydmFibGUoKS5waXBlKGRpc3RpbmN0VW50aWxDaGFuZ2VkKCh4LCB5KSA9PiB4LnRvUmdiYVN0cmluZygpID09IHkudG9SZ2JhU3RyaW5nKCkpKTtcclxuXHJcbiAgICBwcml2YXRlIGNvbG9yUHJlc2V0czogQXJyYXk8QXJyYXk8Q29sb3I+IHwgQ29sb3I+ID0gW107XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgY29uc3QgY29sb3IgPSBDb2xvci5mcm9tKG5ldyBSZ2JhKDI1NSwgMCwgMCwgMSkpO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWUoY29sb3IpO1xyXG4gICAgICAgIHRoaXMuc2V0SHVlQ29sb3IoY29sb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRWYWx1ZUZyb20oY29sb3I6IENvbG9yU3RyaW5nIHwgQ29sb3IgfCBSZ2JhIHwgSHNsYSB8IEhzdmEpOiB0aGlzIHtcclxuICAgICAgICBjb25zdCBuZXdDb2xvciA9IENvbG9yLmZyb20oY29sb3IpO1xyXG4gICAgICAgIGlmICghdGhpcy5pbml0VmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0VmFsdWUgPSBDb2xvci5mcm9tKGNvbG9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgY29sb3IgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmluT3V0SW5wdXRUeXBlKGNvbG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXRIdWVDb2xvcihuZXdDb2xvcik7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZShuZXdDb2xvcik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRIdWVDb2xvcihjb2xvcjogQ29sb3IpIHtcclxuICAgICAgICBpZiAodGhpcy5odWVWYWx1ZSAmJiBjb2xvci5nZXRIc3ZhKCkuaHVlID4gMCB8fCAhdGhpcy5odWVWYWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLmh1ZVZhbHVlID0gbmV3IENvbG9yKCkuc2V0SHN2YShjb2xvci5nZXRIc3ZhKCkuaHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBodWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHVlVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqIHVzZWQgZm9yIHR3by13YXkgZGF0YSBiaW5kaW5nXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZXQgaHVlKGh1ZUNvbG9yOiBDb2xvcikge1xyXG4gICAgICAgIHRoaXMuaHVlVmFsdWUgPSBodWVDb2xvcjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFZhbHVlKHZhbHVlOiBDb2xvcik6IHRoaXMge1xyXG4gICAgICAgIHRoaXMubW9kZWxWYWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2VkLm5leHQodmFsdWUpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgdmFsdWUoKTogQ29sb3Ige1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1vZGVsVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqIHVzZWQgZm9yIHR3by13YXkgZGF0YSBiaW5kaW5nXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZXQgdmFsdWUodmFsdWU6IENvbG9yKSB7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiByZXNldCBjb2xvciB0byBpbml0aWFsXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyByZXNldCgpOiB0aGlzIHtcclxuICAgICAgICBsZXQgY29sb3I7XHJcbiAgICAgICAgaWYgKCF0aGlzLmluaXRWYWx1ZSkge1xyXG4gICAgICAgICAgICBjb2xvciA9IENvbG9yLmZyb20obmV3IFJnYmEoMjU1LCAwLCAwLCAxKSk7XHJcbiAgICAgICAgICAgIHRoaXMuaHVlVmFsdWUgPSBuZXcgQ29sb3IoKS5zZXRIc3ZhKGNvbG9yLmdldEhzdmEoKS5odWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbG9yID0gdGhpcy5pbml0VmFsdWUuY2xvbmUoKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRIdWVDb2xvcihjb2xvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNldFZhbHVlKGNvbG9yKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaXNBbHBoYUNoYW5uZWxFbmFibGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmFscGhhQ2hhbm5lbFZpc2liaWxpdHlDaGFuZ2VzLnZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzaG93QWxwaGFDaGFubmVsKCk6IHRoaXMge1xyXG4gICAgICAgIHRoaXMuYWxwaGFDaGFubmVsVmlzaWJpbGl0eUNoYW5nZXMubmV4dCh0cnVlKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaGlkZUFscGhhQ2hhbm5lbCgpOiB0aGlzIHtcclxuICAgICAgICB0aGlzLmFscGhhQ2hhbm5lbFZpc2liaWxpdHlDaGFuZ2VzLm5leHQoZmFsc2UpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZmluT3V0SW5wdXRUeXBlKGNvbG9yU3RyaW5nOiBDb2xvclN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHN0ciA9IGNvbG9yU3RyaW5nLnJlcGxhY2UoLyAvZywgJycpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgaWYgKHN0clswXSA9PT0gJyMnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdFR5cGUgPSBDb2xvclR5cGUuaGV4O1xyXG4gICAgICAgICAgICBpZiAoc3RyLmxlbmd0aCA+IDcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdFR5cGUgPSBDb2xvclR5cGUuaGV4YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgT3BlblBhcmVudGhlc2lzID0gc3RyLmluZGV4T2YoJygnKTtcclxuICAgICAgICBjb25zdCBjb2xvclR5cGVOYW1lID0gc3RyLnN1YnN0cigwLCBPcGVuUGFyZW50aGVzaXMpO1xyXG4gICAgICAgIHN3aXRjaCAoY29sb3JUeXBlTmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIENvbG9yVHlwZS5yZ2JhOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbml0VHlwZSA9IENvbG9yVHlwZS5yZ2JhO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ29sb3JUeXBlLnJnYjpcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdFR5cGUgPSBDb2xvclR5cGUucmdiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ29sb3JUeXBlLmhzbGE6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRUeXBlID0gQ29sb3JUeXBlLmhzbGE7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDb2xvclR5cGUuaHNsOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbml0VHlwZSA9IENvbG9yVHlwZS5oc2w7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDb2xvclR5cGUuY215azpcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdFR5cGUgPSBDb2xvclR5cGUuY215aztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0Q29sb3JQcmVzZXRzKGNvbG9yUHJlc2V0czogQXJyYXk8QXJyYXk8Q29sb3JTdHJpbmc+IHwgQ29sb3JTdHJpbmc+KTogdGhpcyB7XHJcbiAgICAgICAgdGhpcy5jb2xvclByZXNldHMgPSB0aGlzLnNldFByZXNldHMoY29sb3JQcmVzZXRzKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFByZXNldHMoY29sb3JQcmVzZXRzOiBBcnJheTxBcnJheTxDb2xvclN0cmluZz4gfCBDb2xvclN0cmluZz4pOiBBcnJheTxDb2xvcj4ge1xyXG4gICAgICAgIGNvbnN0IHByZXNldHMgPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBjb2xvciBvZiBjb2xvclByZXNldHMpIHtcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29sb3IpKSB7XHJcbiAgICAgICAgICAgICAgICBwcmVzZXRzLnB1c2godGhpcy5zZXRQcmVzZXRzKGNvbG9yKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwcmVzZXRzLnB1c2gobmV3IENvbG9yKGNvbG9yKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHByZXNldHM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBwcmVzZXRzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbG9yUHJlc2V0cztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaGFzUHJlc2V0cygpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb2xvclByZXNldHMubGVuZ3RoID4gMDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaXNQcmVzZXRWaXNpYmxlKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnByZXNldHNWaXNpYmlsaXR5Q2hhbmdlcy52YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2hvd1ByZXNldHMoKTogdGhpcyB7XHJcbiAgICAgICAgdGhpcy5wcmVzZXRzVmlzaWJpbGl0eUNoYW5nZXMubmV4dCh0cnVlKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaGlkZVByZXNldHMoKTogdGhpcyB7XHJcbiAgICAgICAgdGhpcy5wcmVzZXRzVmlzaWJpbGl0eUNoYW5nZXMubmV4dChmYWxzZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuIl19