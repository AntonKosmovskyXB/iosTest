import { Component, HostBinding, Input, EventEmitter, Output, ChangeDetectionStrategy, HostListener } from '@angular/core';
import { Subject, of } from 'rxjs';
import { takeUntil, delay, map } from 'rxjs/operators';
import { ColorPickerConfig } from './../../../services/color-picker.service';
import * as ɵngcc0 from '@angular/core';
export class ColorPresetComponent {
    constructor(pickerConfig) {
        this.pickerConfig = pickerConfig;
        this.selectionChange = new EventEmitter(false);
        this.longPress = new EventEmitter(false);
        this.mouseup = new Subject();
        this.showDepthText = false;
    }
    set depth(showDepthText) {
        this.showDepthText = !!showDepthText;
    }
    ngOnDestroy() {
        this.mouseup.next();
        this.mouseup.complete();
    }
    get bgColor() {
        return this.color.toRgbaString();
    }
    get title() {
        const color = this.color ? this.color.toHexString() : '';
        if (this.showDepthText) {
            return this.pickerConfig.presetsTitle.replace(/\{\s*(.+?)\s*\}/g, (match, firstMatch) => color);
        }
        return color;
    }
    get className() {
        return this.activeColor ? this.color.toRgbaString() === this.activeColor.toRgbaString() : false;
    }
    onTouch(event) {
        of(event)
            .pipe(map((e) => e.timeStamp || new Date().getTime()), delay(350), takeUntil(this.mouseup))
            .subscribe(() => this.longPress.next(true));
        this.selectionChange.emit(this.color);
    }
    onTouchEnd(event) {
        this.mouseup.next(event);
    }
}
ColorPresetComponent.ɵfac = function ColorPresetComponent_Factory(t) { return new (t || ColorPresetComponent)(ɵngcc0.ɵɵdirectiveInject(ColorPickerConfig)); };
ColorPresetComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ColorPresetComponent, selectors: [["color-preset"]], hostVars: 5, hostBindings: function ColorPresetComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("mousedown", function ColorPresetComponent_mousedown_HostBindingHandler($event) { return ctx.onTouch($event); })("touchstart", function ColorPresetComponent_touchstart_HostBindingHandler($event) { return ctx.onTouch($event); })("mouseup", function ColorPresetComponent_mouseup_HostBindingHandler($event) { return ctx.onTouchEnd($event); })("touchend", function ColorPresetComponent_touchend_HostBindingHandler($event) { return ctx.onTouchEnd($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("title", ctx.title);
        ɵngcc0.ɵɵstyleProp("background-color", ctx.bgColor);
        ɵngcc0.ɵɵclassProp("selected", ctx.className);
    } }, inputs: { depth: ["show-depth-title", "depth"], activeColor: "activeColor", color: "color" }, outputs: { selectionChange: "selectionChange", longPress: "longPress" }, decls: 0, vars: 0, template: function ColorPresetComponent_Template(rf, ctx) { }, styles: ["[_nghost-%COMP%], [_nghost-%COMP%]     *{padding:0;margin:0;box-sizing:border-box}", "[_nghost-%COMP%]{display:inline-block;height:12px;width:12px;position:relative;cursor:pointer;transition:all .2s}"], changeDetection: 0 });
ColorPresetComponent.ctorParameters = () => [
    { type: ColorPickerConfig }
];
ColorPresetComponent.propDecorators = {
    activeColor: [{ type: Input }],
    color: [{ type: Input }],
    depth: [{ type: Input, args: ['show-depth-title',] }],
    selectionChange: [{ type: Output }],
    longPress: [{ type: Output }],
    bgColor: [{ type: HostBinding, args: ['style.backgroundColor',] }],
    title: [{ type: HostBinding, args: ['attr.title',] }],
    className: [{ type: HostBinding, args: ['class.selected',] }],
    onTouch: [{ type: HostListener, args: ['mousedown', ['$event'],] }, { type: HostListener, args: ['touchstart', ['$event'],] }],
    onTouchEnd: [{ type: HostListener, args: ['mouseup', ['$event'],] }, { type: HostListener, args: ['touchend', ['$event'],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ColorPresetComponent, [{
        type: Component,
        args: [{
                selector: `color-preset`,
                template: ``,
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host,:host ::ng-deep *{padding:0;margin:0;box-sizing:border-box}", ":host{display:inline-block;height:12px;width:12px;position:relative;cursor:pointer;transition:all .2s}"]
            }]
    }], function () { return [{ type: ColorPickerConfig }]; }, { selectionChange: [{
            type: Output
        }], longPress: [{
            type: Output
        }], depth: [{
            type: Input,
            args: ['show-depth-title']
        }], bgColor: [{
            type: HostBinding,
            args: ['style.backgroundColor']
        }], title: [{
            type: HostBinding,
            args: ['attr.title']
        }], className: [{
            type: HostBinding,
            args: ['class.selected']
        }], onTouch: [{
            type: HostListener,
            args: ['mousedown', ['$event']]
        }, {
            type: HostListener,
            args: ['touchstart', ['$event']]
        }], onTouchEnd: [{
            type: HostListener,
            args: ['mouseup', ['$event']]
        }, {
            type: HostListener,
            args: ['touchend', ['$event']]
        }], activeColor: [{
            type: Input
        }], color: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItcHJlc2V0LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaXBsYWIvbmd4LWNvbG9yLXBpY2tlci9zcmMvbGliL2NvbXBvbmVudHMvcGFydHMvY29sb3ItcHJlc2V0L2NvbG9yLXByZXNldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILFNBQVMsRUFDVCxXQUFXLEVBQ1gsS0FBSyxFQUNMLFlBQVksRUFDWixNQUFNLEVBQ04sdUJBQXVCLEVBQ3ZCLFlBQVksRUFFZixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNuQyxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN2RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQzs7QUFXN0UsTUFBTSxPQUFPLG9CQUFvQjtBQUFHLElBdUJoQyxZQUE2QixZQUErQjtBQUFJLFFBQW5DLGlCQUFZLEdBQVosWUFBWSxDQUFtQjtBQUFDLFFBVHRELG9CQUFlLEdBQUcsSUFBSSxZQUFZLENBQVEsS0FBSyxDQUFDLENBQUM7QUFDNUQsUUFFVyxjQUFTLEdBQUcsSUFBSSxZQUFZLENBQVUsS0FBSyxDQUFDLENBQUM7QUFDeEQsUUFDWSxZQUFPLEdBQUcsSUFBSSxPQUFPLEVBQTJCLENBQUM7QUFDN0QsUUFDWSxrQkFBYSxHQUFZLEtBQUssQ0FBQztBQUMzQyxJQUNvRSxDQUFDO0FBQ3JFLElBaEJJLElBQ1csS0FBSyxDQUFDLGFBQXNCO0FBQzNDLFFBQVEsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUMsYUFBYSxDQUFDO0FBQzdDLElBQUksQ0FBQztBQUNMLElBYVcsV0FBVztBQUFLLFFBQ25CLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7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LEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQVdBLEFBQUEsQUFBQSxBQUFBLEFBdUJBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFUQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBZkEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFjQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUlBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBSUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUE3RUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUtBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBVkEsQUFBQSxBQWFBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFLQSxBQUFBLEFBR0EsQUFBQSxBQWNBLEFBQUEsQUFBQSxBQUFBLEFBS0EsQUFBQSxBQUFBLEFBQUEsQUFVQSxBQUFBLEFBQUEsQUFBQSxBQUtBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBYUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgSG9zdEJpbmRpbmcsXHJcbiAgICBJbnB1dCxcclxuICAgIEV2ZW50RW1pdHRlcixcclxuICAgIE91dHB1dCxcclxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gICAgSG9zdExpc3RlbmVyLFxyXG4gICAgT25EZXN0cm95XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbG9yLCBDb2xvclN0cmluZyB9IGZyb20gJy4vLi4vLi4vLi4vaGVscGVycy9jb2xvci5jbGFzcyc7XHJcbmltcG9ydCB7IFN1YmplY3QsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRha2VVbnRpbCwgZGVsYXksIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQ29sb3JQaWNrZXJDb25maWcgfSBmcm9tICcuLy4uLy4uLy4uL3NlcnZpY2VzL2NvbG9yLXBpY2tlci5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IGBjb2xvci1wcmVzZXRgLFxyXG4gICAgdGVtcGxhdGU6IGBgLFxyXG4gICAgc3R5bGVVcmxzOiBbXHJcbiAgICAgICAgYC4vLi4vYmFzZS5zdHlsZS5zY3NzYCxcclxuICAgICAgICBgLi9jb2xvci1wcmVzZXQuY29tcG9uZW50LnNjc3NgXHJcbiAgICBdLFxyXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIENvbG9yUHJlc2V0Q29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcclxuXHJcbiAgICBASW5wdXQoKVxyXG4gICAgcHVibGljIGFjdGl2ZUNvbG9yOiBDb2xvcjtcclxuXHJcbiAgICBASW5wdXQoKVxyXG4gICAgcHVibGljIGNvbG9yOiBDb2xvcjtcclxuXHJcbiAgICBASW5wdXQoJ3Nob3ctZGVwdGgtdGl0bGUnKVxyXG4gICAgcHVibGljIHNldCBkZXB0aChzaG93RGVwdGhUZXh0OiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5zaG93RGVwdGhUZXh0ID0gISFzaG93RGVwdGhUZXh0O1xyXG4gICAgfVxyXG5cclxuICAgIEBPdXRwdXQoKVxyXG4gICAgcHVibGljIHNlbGVjdGlvbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Q29sb3I+KGZhbHNlKTtcclxuXHJcbiAgICBAT3V0cHV0KClcclxuICAgIHB1YmxpYyBsb25nUHJlc3MgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KGZhbHNlKTtcclxuXHJcbiAgICBwcml2YXRlIG1vdXNldXAgPSBuZXcgU3ViamVjdDxNb3VzZUV2ZW50IHwgVG91Y2hFdmVudD4oKTtcclxuXHJcbiAgICBwcml2YXRlIHNob3dEZXB0aFRleHQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHBpY2tlckNvbmZpZzogQ29sb3JQaWNrZXJDb25maWcpIHsgfVxyXG5cclxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm1vdXNldXAubmV4dCgpO1xyXG4gICAgICAgIHRoaXMubW91c2V1cC5jb21wbGV0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIEBIb3N0QmluZGluZygnc3R5bGUuYmFja2dyb3VuZENvbG9yJylcclxuICAgIHB1YmxpYyBnZXQgYmdDb2xvcigpOiBDb2xvclN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sb3IudG9SZ2JhU3RyaW5nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdhdHRyLnRpdGxlJylcclxuICAgIHB1YmxpYyBnZXQgdGl0bGUoKSB7XHJcbiAgICAgICAgY29uc3QgY29sb3IgPSB0aGlzLmNvbG9yID8gdGhpcy5jb2xvci50b0hleFN0cmluZygpIDogJyc7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNob3dEZXB0aFRleHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGlja2VyQ29uZmlnLnByZXNldHNUaXRsZS5yZXBsYWNlKC9cXHtcXHMqKC4rPylcXHMqXFx9L2csIChtYXRjaCwgZmlyc3RNYXRjaCkgPT4gY29sb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29sb3I7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5zZWxlY3RlZCcpXHJcbiAgICBwdWJsaWMgZ2V0IGNsYXNzTmFtZSgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVDb2xvciA/IHRoaXMuY29sb3IudG9SZ2JhU3RyaW5nKCkgPT09IHRoaXMuYWN0aXZlQ29sb3IudG9SZ2JhU3RyaW5nKCkgOiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZWRvd24nLCBbJyRldmVudCddKVxyXG4gICAgQEhvc3RMaXN0ZW5lcigndG91Y2hzdGFydCcsIFsnJGV2ZW50J10pXHJcbiAgICBwdWJsaWMgb25Ub3VjaChldmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBvZihldmVudClcclxuICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBtYXAoKGU6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSA9PiBlLnRpbWVTdGFtcCB8fCBuZXcgRGF0ZSgpLmdldFRpbWUoKSksXHJcbiAgICAgICAgICAgICAgICBkZWxheSgzNTApLFxyXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMubW91c2V1cClcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMubG9uZ1ByZXNzLm5leHQodHJ1ZSkpO1xyXG5cclxuICAgICAgICB0aGlzLnNlbGVjdGlvbkNoYW5nZS5lbWl0KHRoaXMuY29sb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ21vdXNldXAnLCBbJyRldmVudCddKVxyXG4gICAgQEhvc3RMaXN0ZW5lcigndG91Y2hlbmQnLCBbJyRldmVudCddKVxyXG4gICAgcHVibGljIG9uVG91Y2hFbmQoZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5tb3VzZXVwLm5leHQoZXZlbnQpO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=